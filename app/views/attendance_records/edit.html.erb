<div class="max-w-3xl mx-auto">
  <div class="bg-white rounded-lg shadow p-8">
    <h1 class="text-2xl font-bold mb-2">출결 기록</h1>
    <p class="text-gray-500 mb-6"><%= @event.display_name %> - <%= @event.date.strftime("%Y-%m-%d") %></p>

    <% if @assignments.any? %>
      <%= form_with url: event_attendance_path(@event), method: :patch, class: "space-y-4" do %>
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b">
              <th class="text-left py-2">봉사자</th>
              <th class="text-left py-2">역할</th>
              <th class="text-left py-2">출결</th>
              <th class="text-left py-2">사유</th>
            </tr>
          </thead>
          <tbody>
            <% @assignments.each do |assignment| %>
              <% record = @records[assignment.member_id] %>
              <tr class="border-b">
                <td class="py-2 font-medium"><%= assignment.member.name %></td>
                <td class="py-2 text-gray-600"><%= assignment.role.name %></td>
                <td class="py-2">
                  <input type="hidden" name="attendance[<%= assignment.member_id %>][assignment_id]" value="<%= assignment.id %>">
                  <select name="attendance[<%= assignment.member_id %>][status]"
                          class="rounded-md border-gray-300 shadow-sm text-sm">
                    <option value="">선택...</option>
                    <% AttendanceRecord::STATUSES.each do |s| %>
                      <option value="<%= s %>" <%= 'selected' if record&.status == s %>>
                        <%= case s
                            when 'present' then '출석'
                            when 'late' then '지각'
                            when 'absent' then '결석'
                            when 'excused' then '사유결석'
                            when 'replaced' then '대타'
                            end %>
                      </option>
                    <% end %>
                  </select>
                </td>
                <td class="py-2">
                  <input type="text" name="attendance[<%= assignment.member_id %>][reason]"
                         value="<%= record&.reason %>"
                         placeholder="사유 (선택)"
                         class="w-full rounded-md border-gray-300 shadow-sm text-sm">
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>

        <div class="flex gap-4 mt-6">
          <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">저장</button>
          <%= link_to "취소", event_path(@event), class: "text-gray-600 hover:text-gray-900 py-2" %>
        </div>
      <% end %>
    <% else %>
      <p class="text-gray-500">배정된 봉사자가 없습니다.</p>
      <%= link_to "돌아가기", event_path(@event), class: "text-blue-600 hover:text-blue-800" %>
    <% end %>
  </div>
</div>
