<div class="dashboard-hero animate-in">
  <div class="dashboard-hero-bg"></div>
  <div class="dashboard-hero-content">
    <h1>&#10013; 성산포 성당 매니저</h1>
    <p>
      안녕하세요, <strong><%= Current.user.name %></strong>님
      <span class="badge" style="margin-left: 0.5rem;"><%= Current.user.role %></span>
    </p>
  </div>
</div>

<% if Current.user.admin? || Current.user.operator? %>
  <!-- 통계 카드 -->
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
    <div class="stat-card ocean animate-in animate-delay-1">
      <div class="stat-value"><%= @upcoming_events_count %></div>
      <div class="stat-label">예정 일정</div>
    </div>
    <div class="stat-card moss animate-in animate-delay-2">
      <div class="stat-value"><%= @active_members_count %></div>
      <div class="stat-label">활성 봉사자</div>
    </div>
    <div class="stat-card sunrise animate-in animate-delay-3">
      <div class="stat-value"><%= @pending_assignments_count %></div>
      <div class="stat-label">미응답 배정</div>
    </div>
    <div class="stat-card ocean animate-in animate-delay-4">
      <div class="stat-value"><%= @this_week_events.size %></div>
      <div class="stat-label">이번 주 일정</div>
    </div>
  </div>

  <!-- 이번 주 일정 + 인력 부족 -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
    <div class="card-basalt" style="padding: 1.5rem;">
      <h3 class="section-title">이번 주 일정</h3>
      <% if @this_week_events.any? %>
        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
          <% @this_week_events.each do |event| %>
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid var(--basalt-100);">
              <%= link_to event.display_name, event_path(event), class: "link-ocean" %>
              <span style="font-size: 0.8rem; color: var(--basalt-500);"><%= event.date.strftime("%m/%d %a") %> <%= event.start_time.strftime("%H:%M") %></span>
            </div>
          <% end %>
        </div>
      <% else %>
        <p style="color: var(--basalt-400); font-size: 0.875rem;">이번 주 예정된 일정이 없습니다.</p>
      <% end %>
    </div>

    <div class="card-basalt" style="padding: 1.5rem;">
      <h3 class="section-title">인력 부족 경고</h3>
      <% if @shortage_roles.any? %>
        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
          <% @shortage_roles.each do |s| %>
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid var(--basalt-100);">
              <div>
                <span style="font-size: 0.875rem;"><%= s[:event].display_name %></span>
                <span class="badge badge-basalt" style="margin-left: 0.375rem;"><%= s[:role].name %></span>
              </div>
              <span class="badge badge-lava"><%= s[:assigned] %>/<%= s[:required] %>명</span>
            </div>
          <% end %>
        </div>
      <% else %>
        <p style="color: var(--basalt-400); font-size: 0.875rem;">부족한 역할이 없습니다.</p>
      <% end %>
    </div>
  </div>
<% end %>

<!-- 최신 뉴스 + 최근 게시글 -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
  <div class="card-basalt animate-in" style="padding: 1.5rem;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
      <h3 class="section-title" style="margin: 0;">&#128240; 최신 뉴스</h3>
      <%= link_to "더보기 &rarr;".html_safe, news_articles_path, style: "font-size: 0.8rem; color: var(--ocean-600); text-decoration: none;" %>
    </div>
    <% if @recent_news.any? %>
      <div style="display: flex; flex-direction: column; gap: 0.5rem;">
        <% @recent_news.each do |article| %>
          <div style="display: flex; justify-content: space-between; align-items: flex-start; padding: 0.5rem 0; border-bottom: 1px solid var(--basalt-100); gap: 0.5rem;">
            <div style="flex: 1; min-width: 0;">
              <span class="badge <%= article.source_badge_class %>" style="font-size: 0.65rem; margin-right: 0.25rem;"><%= article.source_label %></span>
              <%= link_to truncate(article.title, length: 40), news_article_path(article), class: "link-ocean", style: "font-size: 0.875rem;" %>
            </div>
            <span style="font-size: 0.75rem; color: var(--basalt-400); white-space: nowrap;"><%= article.published_at&.strftime("%m/%d") %></span>
          </div>
        <% end %>
      </div>
    <% else %>
      <p style="color: var(--basalt-400); font-size: 0.875rem;">아직 수집된 뉴스가 없습니다.</p>
    <% end %>
  </div>

  <div class="card-basalt animate-in" style="padding: 1.5rem;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
      <h3 class="section-title" style="margin: 0;">&#128172; 최근 게시글</h3>
      <%= link_to "더보기 &rarr;".html_safe, posts_path, style: "font-size: 0.8rem; color: var(--ocean-600); text-decoration: none;" %>
    </div>
    <% if @recent_posts.any? %>
      <div style="display: flex; flex-direction: column; gap: 0.5rem;">
        <% @recent_posts.each do |post| %>
          <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid var(--basalt-100);">
            <div style="flex: 1; min-width: 0;">
              <% if post.pinned? %>
                <span class="badge badge-sunrise" style="font-size: 0.65rem;">&#128204;</span>
              <% end %>
              <%= link_to truncate(post.title, length: 30), post_path(post), class: "link-ocean", style: "font-size: 0.875rem;" %>
              <span style="font-size: 0.75rem; color: var(--basalt-400); margin-left: 0.25rem;">&#128172; <%= post.comments_count || 0 %></span>
            </div>
            <span style="font-size: 0.75rem; color: var(--basalt-400); white-space: nowrap;"><%= post.author.name %> &middot; <%= post.created_at.strftime("%m/%d") %></span>
          </div>
        <% end %>
      </div>
    <% else %>
      <p style="color: var(--basalt-400); font-size: 0.875rem;">아직 게시글이 없습니다.</p>
    <% end %>
  </div>
</div>

<!-- 빠른 접근 -->
<h3 class="section-title animate-in">빠른 접근</h3>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
  <%= link_to news_articles_path, class: "quick-card animate-in animate-delay-1" do %>
    <div class="quick-icon">&#128240;</div>
    <div class="quick-title">가톨릭 뉴스</div>
    <div class="quick-desc">최신 가톨릭 뉴스 모아보기</div>
  <% end %>
  <%= link_to posts_path, class: "quick-card animate-in animate-delay-2" do %>
    <div class="quick-icon">&#128172;</div>
    <div class="quick-title">게시판</div>
    <div class="quick-desc">소소한 일상 나누기</div>
  <% end %>
  <%= link_to photo_albums_path, class: "quick-card animate-in animate-delay-3" do %>
    <div class="quick-icon">&#128247;</div>
    <div class="quick-title">갤러리</div>
    <div class="quick-desc">활동 사진 모아보기</div>
  <% end %>

  <% if Current.user.admin? || Current.user.operator? %>
    <%= link_to members_path, class: "quick-card animate-in animate-delay-1" do %>
      <div class="quick-icon">&#128101;</div>
      <div class="quick-title">봉사자 관리</div>
      <div class="quick-desc">봉사자 목록 및 정보 관리</div>
    <% end %>
    <%= link_to events_path, class: "quick-card animate-in animate-delay-2" do %>
      <div class="quick-icon">&#128197;</div>
      <div class="quick-title">일정 관리</div>
      <div class="quick-desc">미사 일정 및 반복 일정</div>
    <% end %>
    <%= link_to notifications_path, class: "quick-card animate-in animate-delay-3" do %>
      <div class="quick-icon">&#128276;</div>
      <div class="quick-title">알림</div>
      <div class="quick-desc">알림 이력 확인</div>
    <% end %>
  <% end %>

  <% if Current.user.admin? %>
    <%= link_to admin_roles_path, class: "quick-card animate-in animate-delay-1" do %>
      <div class="quick-icon">&#127919;</div>
      <div class="quick-title">역할 관리</div>
      <div class="quick-desc">복사 역할 설정</div>
    <% end %>
    <%= link_to admin_event_types_path, class: "quick-card animate-in animate-delay-2" do %>
      <div class="quick-icon">&#9962;</div>
      <div class="quick-title">미사유형 관리</div>
      <div class="quick-desc">미사 유형 및 시간 설정</div>
    <% end %>
    <%= link_to admin_users_path, class: "quick-card animate-in animate-delay-3" do %>
      <div class="quick-icon">&#128274;</div>
      <div class="quick-title">사용자 관리</div>
      <div class="quick-desc">계정 및 권한 관리</div>
    <% end %>
  <% end %>

  <div class="quick-card animate-in animate-delay-4">
    <div class="quick-icon">&#128100;</div>
    <div class="quick-title">내 정보</div>
    <div class="quick-desc">
      <% if Current.user.member_role? && Current.user.member %>
        <%= link_to "내 프로필", profile_path, class: "link-ocean" %> &middot;
      <% end %>
      <%= link_to "비밀번호 변경", edit_password_path, class: "link-ocean" %>
    </div>
  </div>
</div>
