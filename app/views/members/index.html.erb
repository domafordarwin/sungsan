<div class="flex justify-between items-center mb-6">
  <h1 class="text-2xl font-bold">봉사자 관리</h1>
  <% if policy(Member).create? %>
    <%= link_to "새 봉사자", new_member_path, class: "bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" %>
  <% end %>
</div>

<!-- 검색 + 필터 -->
<%= form_with url: members_path, method: :get, class: "bg-white rounded-lg shadow p-4 mb-6", data: { turbo_frame: "members_list" } do |f| %>
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
    <div>
      <%= f.label :q, "검색", class: "block text-sm font-medium text-gray-700" %>
      <%= f.text_field :q, value: params[:q], placeholder: "이름, 세례명, 구역",
          class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
    </div>
    <div>
      <%= f.label :active, "활동 상태", class: "block text-sm font-medium text-gray-700" %>
      <%= f.select :active, [["전체", ""], ["활동", "true"], ["비활동", "false"]],
          { selected: params[:active] }, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm" %>
    </div>
    <div>
      <%= f.label :baptized, "세례", class: "block text-sm font-medium text-gray-700" %>
      <%= f.select :baptized, [["전체", ""], ["세례", "true"]],
          { selected: params[:baptized] }, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm" %>
    </div>
    <div class="flex items-end">
      <%= f.submit "검색", class: "bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 cursor-pointer" %>
      <%= link_to "초기화", members_path, class: "ml-2 text-gray-600 hover:text-gray-900 py-2" %>
    </div>
  </div>
<% end %>

<!-- 목록 -->
<%= turbo_frame_tag "members_list" do %>
  <table class="min-w-full bg-white rounded-lg shadow">
    <thead class="bg-gray-50">
      <tr>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">이름</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">세례명</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">연락처</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">구역</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">상태</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">관리</th>
      </tr>
    </thead>
    <tbody>
      <% @members.each do |member| %>
        <tr class="border-t">
          <td class="px-6 py-4"><%= member.name %></td>
          <td class="px-6 py-4"><%= member.baptismal_name %></td>
          <td class="px-6 py-4"><%= member.masked_phone %></td>
          <td class="px-6 py-4"><%= member.district %></td>
          <td class="px-6 py-4">
            <span class="<%= member.active? ? 'text-green-600' : 'text-red-600' %>">
              <%= member.active? ? "활동" : "비활동" %>
            </span>
          </td>
          <td class="px-6 py-4">
            <%= link_to "보기", member_path(member), class: "text-blue-600 hover:text-blue-800" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <!-- 페이지네이션 -->
  <% page = [params[:page].to_i, 1].max %>
  <div class="mt-4 flex justify-center gap-2">
    <% if page > 1 %>
      <%= link_to "이전", members_path(request.query_parameters.merge(page: page - 1)),
          class: "px-4 py-2 bg-white rounded shadow text-gray-600 hover:bg-gray-50" %>
    <% end %>
    <span class="px-4 py-2 bg-blue-600 text-white rounded shadow"><%= page %></span>
    <% if @members.size >= 20 %>
      <%= link_to "다음", members_path(request.query_parameters.merge(page: page + 1)),
          class: "px-4 py-2 bg-white rounded shadow text-gray-600 hover:bg-gray-50" %>
    <% end %>
  </div>
<% end %>
