<div class="page-header animate-in">
  <h1>일정 관리</h1>
  <div class="flex gap-2">
    <% if policy(Event).create? %>
      <%= link_to "새 일정", new_event_path, class: "btn-ocean" %>
    <% end %>
    <% if policy(Event).bulk_create? %>
      <%= link_to "반복 일정", bulk_new_events_path, class: "btn-moss" %>
    <% end %>
  </div>
</div>

<!-- 필터 -->
<div class="filter-panel animate-in animate-delay-1">
  <%= form_tag events_path, method: :get, class: "flex flex-wrap gap-4 items-end" do %>
    <div>
      <label class="label-basalt">미사유형</label>
      <%= select_tag :event_type_id,
          options_from_collection_for_select(@event_types, :id, :name, params[:event_type_id]),
          include_blank: "전체", class: "input-basalt" %>
    </div>
    <div>
      <label class="label-basalt">시작일</label>
      <%= date_field_tag :from, params[:from], class: "input-basalt" %>
    </div>
    <div>
      <label class="label-basalt">종료일</label>
      <%= date_field_tag :to, params[:to], class: "input-basalt" %>
    </div>
    <%= submit_tag "검색", class: "btn-ocean cursor-pointer" %>
    <%= link_to "초기화", events_path, class: "btn-ghost" %>
  <% end %>

  <div class="flex gap-4 mt-3">
    <%= link_to "다가오는 일정", events_path,
        class: "period-tab #{params[:view].blank? ? 'active' : 'inactive'}" %>
    <%= link_to "지난 일정", events_path(view: "past"),
        class: "period-tab #{params[:view] == 'past' ? 'active' : 'inactive'}" %>
  </div>
</div>

<!-- 일정 목록 -->
<div class="animate-in animate-delay-2">
  <table class="table-stone">
    <thead>
      <tr>
        <th>날짜</th>
        <th>시간</th>
        <th>미사유형</th>
        <th>제목</th>
        <th>장소</th>
        <th>관리</th>
      </tr>
    </thead>
    <tbody>
      <% @events.each do |event| %>
        <tr>
          <td style="font-weight: 500; color: var(--basalt-800);"><%= event.date.strftime("%Y-%m-%d (%a)") %></td>
          <td style="color: var(--basalt-500);"><%= event.start_time.strftime("%H:%M") %></td>
          <td><span class="badge badge-ocean"><%= event.event_type.name %></span></td>
          <td><%= event.title || "-" %></td>
          <td style="color: var(--basalt-500);"><%= event.location || "-" %></td>
          <td>
            <%= link_to "보기", event_path(event), class: "link-ocean", style: "font-size: 0.8rem;" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <% if @events.empty? %>
    <div style="text-align: center; padding: 3rem; color: var(--basalt-400);">
      등록된 일정이 없습니다.
    </div>
  <% end %>
</div>
